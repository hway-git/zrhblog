document.onreadystatechange=completeLoading;function completeLoading(){if(document.readyState==='complete'){$('#preloader_1').fadeOut(2000);}}window.addEventListener("scroll",function(){const header=$('.sticky-nav');const nav_container=$('.container-fluid');const menu=$('.nav-dropdown-menu');header.toggleClass('sticky',window.scrollY>350);header.toggleClass('moveTop',window.scrollY>100);menu.toggleClass('menu-change-color',window.scrollY>350);nav_container.toggleClass('slideToUp',window.scrollY>350);});let script=$("<script id='c_n_script' src='/static/blog/js/lizi.js' color='0,0,0'pacity='0.7' count='100' zindex='-2'>");$('body').append(script);$('.tab-head a').hover(function(){if(!$(this).find('a').hasClass('tab-active')){$(this).addClass('tab-a-black')}},function(){if(!$(this).find('a').hasClass('tab-active')){$(this).removeClass('tab-a-black')}});$(".tab-head li").click(function(){let index=$(this).index();let a=$(this).find('a');if(!a.hasClass('tab-active')){a.addClass('tab-active');$(this).siblings().find('a').removeClass('tab-active')}$('.tab-content .tab-item').eq(index).show().siblings().hide()});$('.blog-list-toggle input').click(function(){const blog_list=$('.blog');const blog_as_card=$('.blog-as-card');const blog_list_content=$('.blog-list-content');const blog_card_list=$('.blog-list-content .panel-body');if($(this).is(':checked')){blog_list.hide();blog_as_card.addClass('show-card');blog_list_content.addClass('change-blog-list-back');blog_card_list.addClass('change-blog-card-padding');}else{blog_list.show();blog_as_card.removeClass('show-card');blog_as_card.hide();blog_list_content.removeClass('change-blog-list-back');blog_card_list.removeClass('change-blog-card-padding');}});$('.loginBox input').focus(function(){if($('.auth-faild').text()!=null){$('.auth-faild').text('')}});$('.registerBox input').focus(function(){if($('.auth-faild').text()!=null){$('.auth-faild').text('')}});$('.pwdshow').click(function(){if($(this).find('span').hasClass('glyphicon-eye-close')){$(this).find('span').removeClass('glyphicon-eye-close');$(this).find('span').addClass('glyphicon-eye-open');$('input[name=password]').attr("type","text");$('input[name=pwd_again]').attr("type","text");}else{$(this).find('span').removeClass('glyphicon-eye-open');$(this).find('span').addClass('glyphicon-eye-close');$('input[name=password]').attr("type","password");$('input[name=pwd_again]').attr("type","password");}});function showtoastSubmitComment(){showMessage('评论成功~',1500,true,'bounceIn-hastrans','bounceOut-hastrans');}String.prototype.format=function(){let str=this;for(let i=0;i<arguments.length;i++){str=str.replace(new RegExp('\\{'+i+'\\}','g'),arguments[i])}return str;};$('#comment-form').submit(function(){$('.submit-comment-button').attr('disabled',true);setTimeout(function(){$('.submit-comment-button').attr('disabled',false)},1000);let comment_error=$('#comment-error');let reply_comment_id=$('#reply_comment_id');let comment_count=$('#comment_count');comment_error.text('');if(CKEDITOR.instances['id_text'].document.getBody().getText().trim()===""){comment_error.text('评论内容不能为空！');return false;}CKEDITOR.instances['id_text'].updateElement();$.ajax({url:"/comment/submit_comment/",type:"POST",data:$(this).serialize(),cache:false,success:function(data){if(data['status']==='SUCCESS'){if(reply_comment_id.val()==='0'){let comment_html='';console.log(data['is_myself']);if(data['is_myself']==='false'){comment_html='<div class="media comment-list-detail"> <div class="media-left media-middle comment-list-detail-img"> <img class="media-object img-circle" src="/static/blog/img/comment-list-img.jpg"alt="..."> </div> <div  id="root_{0}" class="media-body comment-list-detail-body"> <h5 class="media-heading comment-list-detail-body-user">{1}</h5> <div id="comment-{0}" class="comment-list-detail-body-content">{2}</div> <div class="comment-list-detail-body-info"><span class="comment-list-detail-body-info-time">{3}</span> <span class="comment-like" onclick="likeChanged(this,\'{4}\',{0})"> <span class="like-icon iconfont icon-dianzan"></span> <span class="like-num">0</span> </span> <a href="javascript:reply({0});">回复</a> </div></div></div>';}else{comment_html='<div class="media comment-list-detail"> <div class="media-left media-middle comment-list-detail-img"> <img class="media-object img-circle" src="/static/blog/img/comment-list-img.jpg"alt="..."> </div> <div  id="root_{0}" class="media-body comment-list-detail-body"> <h5 class="media-heading comment-list-detail-body-user">{1}</h5> <div id="comment-{0}" class="comment-list-detail-body-content">{2}</div> <div class="comment-list-detail-body-info"><span class="comment-list-detail-body-info-time">{3}</span> <span class="comment-like" onclick="likeChanged(this,\'{4}\',{0})"> <span class="like-icon iconfont icon-dianzan"></span> <span class="like-num">0</span> </span></div></div></div>';}comment_html=comment_html.format(data['pk'],data['username'],data['text'],data['comment_time'],data['content_type'],);$('#comment-list').append(comment_html);console.log(comment_count.text());comment_count.text(parseInt(comment_count.text())+1);}else{let reply_html='<div class="media comment-list-detail"><div class="media-left media-middle comment-list-detail-reply-img"><img class="media-object img-circle"src="/static/blog/img/comment-list-img.jpg"alt="..."></div><div class="media-body reply-list-detail-body comment-list-detail-body"><h5 class="media-heading comment-list-detail-body-user">{0}</h5><div id="comment-{1}"class="comment-list-detail-body-content">{2}</div><div class="comment-list-detail-body-info"><span class="comment-list-detail-body-info-time">{3}</span> <span class="comment-like" onclick="likeChanged(this,\'{4}\',{1})"> <span class="like-icon iconfont icon-dianzan"></span> <span class="like-num">0</span> </span> <a href="javascript:reply({1});">回复</a></div></div></div>';reply_html=reply_html.format(data['username'],data['pk'],data['text'],data['comment_time'],data['content_type']);$("#root_"+data['root_pk']).append(reply_html);}showtoastSubmitComment();CKEDITOR.instances['id_text'].setData('');$('#reply-content-container').hide();reply_comment_id.val('0');$('.none-comment').remove();}else{comment_error.text(data['message'])}},error:function(xhr){console.log(xhr);}});return false});function reply(reply_comment_id){$('#reply_comment_id').val(reply_comment_id);let html=$("#comment-"+reply_comment_id).html();$('#reply-content').html(html);$('#reply-content-container').show();$('html,body').animate({scrollTop:$('#comment-form').offset().top-60},300,function(){CKEDITOR.instances['id_text'].focus()});}function likeChanged(obj,conntent_type,object_id){let is_like=obj.getElementsByClassName('active').length===0;$.ajax({url:"/like/like_change",type:'GET',data:{content_type:conntent_type,object_id:object_id,is_like:is_like,},cache:false,success:function(data){console.log(data);if(data['status']==='SUCCESS'){let element=$(obj.getElementsByClassName('like-icon'));console.log(element,is_like);if(is_like){element.addClass('active')}else{element.removeClass('active')}let like_num=$('.article-like-num');like_num.text(data['like_num']+'赞')}else{if(data['code']===400){$('#loginModal').modal('show');}else{alert(data['message'])}}},error:function(xhr){console.log(xhr)}});}$('#login-modal-form').submit(function(event){event.preventDefault();$.ajax({url:'/user/login_for_modal/',type:'POST',data:$(this).serialize(),cache:false,success:function(data){if(data['status']==='SUCCESS'){console.log(data['status']);window.location.reload();}else{$('#login-modal-tip').text('用户名或密码不正确');}}});});$(function(){if(window.location.hash){$("html,body").stop(true);$('html,body').animate({scrollTop:$(window.location.hash).offset().top-70},500);}});$('.cancle-reply').click(function(){let reply_comment_id=$('#reply_comment_id');$('#reply-content-container').hide();$('html,body').animate({scrollTop:$('#comment-'+reply_comment_id.val()).offset().top-140},300);reply_comment_id.val('0');});